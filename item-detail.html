<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>商品詳細 | つむぐね</title>
    <link rel="stylesheet" href="./style.css">
    <style>
        .product-grid {
            display: grid;
            grid-template-columns: 1.2fr 1fr;
            gap: var(--spacing-lg);
            align-items: start;
            margin: 0 auto;
        }

        @media (max-width: 1024px) {
            .product-grid {
                gap: var(--spacing-md);
            }
        }

        @media (max-width: 768px) {
            .product-grid {
                grid-template-columns: 1fr;
                gap: var(--spacing-md);
            }
        }

        .info-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.85rem;
            margin-top: var(--spacing-sm);
        }

        .info-table th,
        .info-table td {
            text-align: left;
            padding: 8px 0;
            border-bottom: 1px solid #F0F0F0;
        }

        .info-table th {
            font-weight: 500;
            color: var(--text-muted);
            width: 100px;
        }

        .size-chart {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.8rem;
            margin-top: var(--spacing-sm);
            text-align: center;
        }

        .size-chart th,
        .size-chart td {
            padding: 8px;
            border: 1px solid #F0F0F0;
        }

        .size-chart th {
            background: #FAFAFA;
            font-weight: 500;
        }

        .color-picker-wrapper {
            margin-top: var(--spacing-sm);
        }

        .color-picker {
            display: flex;
            gap: 12px;
            margin-bottom: 8px;
        }

        .color-btn {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid #EEE;
            transition: var(--transition);
            position: relative;
        }

        .color-btn.active {
            border-color: var(--text-main);
            transform: scale(1.1);
        }

        #selected-color-name {
            font-size: 0.8rem;
            color: var(--text-main);
            font-weight: 500;
        }

        .size-picker {
            display: flex;
            gap: 8px;
            margin-top: var(--spacing-sm);
        }

        .size-btn {
            padding: 8px 16px;
            border: 1px solid #EEE;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: var(--transition);
        }

        .size-btn.active {
            background: var(--text-main);
            color: #FFF;
            border-color: var(--text-main);
        }
    </style>
</head>

<body>
    <header>
        <div class="container nav">
            <a href="./index.html" class="logo">つむぐね</a>
            <nav class="nav-links">
                <a href="./index.html">トップページ <span class="text-xs">Top</span></a>
            </nav>
        </div>
    </header>

    <main class="container section">
        <div class="product-grid">
            <!-- Image Slider -->
            <div class="slider-container card" style="padding: 0;">
                <div class="slider-track" id="slider-track">
                    <!-- Slides will be injected by JS -->
                </div>
                <div class="slider-arrow arrow-prev" id="prev-btn">＜</div>
                <div class="slider-arrow arrow-next" id="next-btn">＞</div>
                <div class="slider-nav" id="slider-nav">
                    <!-- Dots will be injected by JS -->
                </div>
            </div>

            <!-- Product Info -->
            <div>
                <p class="brand-accent">Collection Piece</p>
                <h1 id="product-name" style="margin-bottom: 8px;">アイテム名</h1>
                <p id="product-price" class="serif-font"
                    style="font-size: 1.5rem; border-bottom: 1px solid #EEE; padding-bottom: var(--spacing-sm); margin-bottom: var(--spacing-md);">
                    ¥0,000</p>

                <div class="mb-lg">
                    <p class="text-sm">カラーを選択 <span class="text-xs">Color</span></p>
                    <div class="color-picker-wrapper">
                        <div class="color-picker" id="color-picker">
                            <!-- Colors will be injected by JS -->
                        </div>
                        <div id="selected-color-name"></div>
                    </div>
                </div>

                <div class="mb-lg" id="size-selector-container">
                    <p class="text-sm mb-sm">サイズを選択 <span class="text-xs">Size</span></p>
                    <div class="size-picker" id="size-picker">
                        <!-- Sizes will be injected by JS -->
                    </div>
                </div>

                <div class="mb-lg">
                    <p class="text-sm mb-sm">商品説明 <span class="text-xs">Description</span></p>
                    <p id="product-desc" style="font-weight: 300; font-size: 0.95rem;"></p>
                </div>

                <div id="product-specs" class="mb-lg">
                    <!-- Specs will be injected by JS -->
                </div>

                <button onclick="proceedToCustomize()" class="btn btn-primary" style="width: 100%;">音を刺繍する</button>
            </div>
        </div>
    </main>

    <script src="./script.js"></script>
    <script>
        const params = new URLSearchParams(window.location.search);
        const itemType = params.get('item') || 'tshirt';

        const itemData = {
            tshirt: {
                name: '<span class="title-sub">6.2オンス</span>プレミアムTシャツ',
                engName: 'T-shirt',
                price: '¥6,000',
                desc: '時が経つほどに愛着がわく、究極の一枚。素材から縫製まで妥協なく仕上げたハイグレードモデル。毛羽立ちを抑える「コーマ糸」と強固な「ダブルステッチ」を採用し、何度洗っても型崩れしないタフさを実現しました。日常のなかに、色褪せない記憶をまとう贅沢を。',
                colors: [{ name: 'ホワイト', code: '#FFF' }],
                sizes: ['S', 'M', 'L', 'XL'],
                specs: {
                    '素材': '基本：綿 100％',
                    '生地': '天竺編み（コーマ糸）',
                    '備考': '丸胴仕様'
                },
                chart: {
                    headers: ['サイズ', '身丈', '身幅', '肩幅', '袖丈'],
                    rows: [['S', '63', '47', '42', '18'], ['M', '68', '52', '46', '22'], ['L', '72', '55', '50', '22'], ['XL', '75', '60', '55', '23']]
                },
                images: ['#FDFDFB', '#FAFAFA', '#F5F5F5']
            },
            bib: {
                name: 'ビブ',
                engName: 'Bib',
                price: '¥5,000',
                desc: '赤ちゃんの「今」を、一番近くで見守る。10.0オンスの極厚パイル生地が生む、圧倒的な安心感。吸水性に優れ、元気な赤ちゃんの日常をしっかりサポートします。初めての言葉や産声の波形を、毎日触れるやわらかな質感とともに残しませんか。',
                colors: [{ name: 'ホワイト', code: '#FFF' }, { name: 'ナチュラル', code: '#F5F5DC' }],
                sizes: ['F'],
                specs: { '素材': '10.0オンス 極厚パイル' },
                images: ['#E8D5D5', '#F5E6E6']
            },
            pouch: {
                name: 'ジッパーポーチ',
                engName: 'Pouch',
                price: '¥5,000',
                desc: '大切な音を、どこへでも連れて行く。上質なフェアトレードコットンを使用したキャンバスポーチ。たっぷりとしたマチと便利なハンドル付きで、旅行のサブバッグとしても活躍する大容量サイズです。地球にも使う人にも優しい素材が、あなたの特別な波形を包み込みます。',
                colors: [{ name: 'ナチュラル', code: '#F5F5DC' }],
                sizes: ['F'],
                specs: { '商品サイズ': '約200ｘ150ｘ80mm', '素材': 'コットン', '備考': 'ﾌｪｱﾄﾚｰﾄﾞｵｰｶﾞﾆｯｸｺｯﾄﾝ使用､取説付' },
                images: ['#D1E5F4', '#E6F0F8']
            },
            lunchbag: {
                name: 'ランチバッグ',
                engName: 'Lunch Bag',
                price: '¥5,500',
                desc: '暮らしに寄り添う、頑丈で身軽な相棒。ガシガシ使える頑丈なキャンバス生地が特徴のトートバッグ。しっかり自立する安定感がありながら、使わない時は折りたたんでコンパクトに。ちょっとしたお出かけが、世界にひとつのデザインで特別な時間に変わります。',
                colors: [{ name: 'ライトグレー', code: '#D3D3D3' }, { name: 'ナチュラル', code: '#F5F5DC' }],
                sizes: ['F'],
                specs: { '素材': '綿 100％', '生地': 'キャンバス' },
                chart: {
                    headers: ['サイズ', '高さ', '幅', '底幅', 'マチ', '持手', '容量'],
                    rows: [['F', '21', '37', '20', '17', '37', '約7L']]
                },
                images: ['#EEE', '#E0E0E0']
            }
        };

        const data = itemData[itemType];
        const productNameElement = document.getElementById('product-name');
        productNameElement.innerHTML = `${data.name} <span class="text-xs" style="font-weight:300;">${data.engName}</span>`;
        document.getElementById('product-price').innerText = data.price;
        document.getElementById('product-desc').innerText = data.desc;

        const track = document.getElementById('slider-track');
        const nav = document.getElementById('slider-nav');
        data.images.forEach((img, i) => {
            const slide = document.createElement('div');
            slide.className = 'slider-slide';
            slide.style.backgroundColor = img;
            slide.innerHTML = `<span class="serif-font" style="font-size: 2rem; color: #999;">${data.engName} Photo ${i + 1}</span>`;
            track.appendChild(slide);

            const dot = document.createElement('div');
            dot.className = `slider-dot ${i === 0 ? 'active' : ''}`;
            dot.onclick = () => goToSlide(i);
            nav.appendChild(dot);
        });

        let currentSlide = 0;
        function goToSlide(n) {
            const count = data.images.length;
            currentSlide = (n + count) % count;
            track.style.transform = `translateX(-${currentSlide * 100}%)`;
            document.querySelectorAll('.slider-dot').forEach((dot, i) => {
                dot.classList.toggle('active', i === currentSlide);
            });
        }

        document.getElementById('prev-btn').onclick = () => goToSlide(currentSlide - 1);
        document.getElementById('next-btn').onclick = () => goToSlide(currentSlide + 1);

        const colorPicker = document.getElementById('color-picker');
        const colorNameDisplay = document.getElementById('selected-color-name');
        data.colors.forEach((c, i) => {
            const btn = document.createElement('div');
            btn.className = `color-btn ${i === 0 ? 'active' : ''}`;
            btn.style.backgroundColor = c.code;
            btn.dataset.name = c.name;
            if (i === 0) colorNameDisplay.innerText = c.name;
            btn.onclick = () => {
                document.querySelectorAll('.color-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                colorNameDisplay.innerText = c.name;
            };
            colorPicker.appendChild(btn);
        });

        const sizePicker = document.getElementById('size-picker');
        data.sizes.forEach((s, i) => {
            const btn = document.createElement('div');
            btn.className = `size-btn ${i === 0 ? 'active' : ''}`;
            btn.innerText = s;
            btn.onclick = () => {
                document.querySelectorAll('.size-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
            };
            sizePicker.appendChild(btn);
        });

        const specsContainer = document.getElementById('product-specs');
        let specsHtml = '<table class="info-table">';
        for (let k in data.specs) { specsHtml += `<tr><th>${k}</th><td>${data.specs[k]}</td></tr>`; }
        specsHtml += '</table>';
        if (data.chart) {
            specsHtml += '<table class="size-chart"><thead><tr>';
            data.chart.headers.forEach(h => specsHtml += `<th>${h}</th>`);
            specsHtml += '</tr></thead><tbody>';
            data.chart.rows.forEach(r => {
                specsHtml += '<tr>';
                r.forEach(v => specsHtml += `<td>${v}</td>`);
                specsHtml += '</tr>';
            });
            specsHtml += '</tbody></table>';
        }
        specsContainer.innerHTML = specsHtml;

        function proceedToCustomize() {
            const selectedColor = document.querySelector('.color-btn.active').dataset.name;
            const selectedSize = document.querySelector('.size-btn.active') ? document.querySelector('.size-btn.active').innerText : 'F';
            localStorage.setItem('selectedItem', JSON.stringify({
                type: itemType, name: data.name.replace(/<[^>]*>?/gm, ''), price: data.price, color: selectedColor, size: selectedSize
            }));
            window.location.href = './customize.html';
        }
    </script>
</body>

</html>